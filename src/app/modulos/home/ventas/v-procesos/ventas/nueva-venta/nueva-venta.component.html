<div *ngIf="!VistaReporte && !VistaCobrar ">
    <div class="margintabla">

        <ngx-spinner bdColor="rgba(0,0,0,0.8)" size="meidum" color="#fff" type="timer" [fullScreen]="true">
            <p style="font-size: 20px; color: white">Cargando... porfavor espere </p>
        </ngx-spinner>
        
        <form [formGroup]="Form">
            <div class="row">
                <div [ngClass]="{'col-md-11': changeCols, 'col-md-7': !changeCols }">
                    <div class="container-fluid">
                        <div class="card-box">
                            <p-toolbar>
                                <div class="p-toolbar-group-left">
                                    <h3> <i class="fas fa-cart-plus"></i> {{ tituloNuevaVenta}} </h3>
                                </div>

                                <div class="p-toolbar-group-right">
                                    <button *ngIf="mostrarOpcionesEditar" pButton class="p-button-generico-azul"
                                        type="button" style="margin-right: 1%;" pTooltip="Cobrar" tooltipPosition="top"
                                        (click)="onCobrar()" label="Cobrar" icon="fas fa-coins"></button>
                                    <p-tieredMenu #menu [model]="opcionesNuevaVenta" appendTo="body" [popup]="true">
                                    </p-tieredMenu>

                                    <button #btn
                                        *ngIf="mostrarOpcionesEditar" 
                                        style="margin-right: 1%;"
                                        class="p-button-generico-azul" type="button" pButton label="Opciones"
                                        icon="pi pi-cog" (click)="menu.toggle($event)">
                                    </button>

                                    <button class="p-button-registrar"
                                        pButton type="button" 
                                        [disabled]="Form.invalid"
                                        [label]=" (!VentaEditar) ? 'Grabar' : 'Actualizar'"
                                        (click)="onGrabar()" icon="pi pi-check-circle">
                                    </button>

                                    <button class="p-button-cancelar" pButton type="button" icon="pi pi-times-circle"
                                        label="Cancelar" (click)="onRegresar()">
                                    </button>

                                </div>
                            </p-toolbar>

                            <div *ngIf="existenroRegsitro" class="centrar">
                                <h3> N° REGISTRO: <strong> {{VentaEditar.nroRegistro}} </strong></h3>
                            </div>

                            <div class="p-col-12">
                                <div class="p-fluid p-formgrid p-grid formulario-campo-obligatorio">
                                    <div class="p-field p-col-12 p-md-3 p-sm-4">
                                        <strong>Establecimiento <span>*</span></strong>
                                        <p-dropdown class="DropExtenso fondo-gris"
                                            (onChange)="onObtenerEstablecimiento($event)" [options]="arrayEstablecimiento"
                                            formControlName="establecimientoid" placeholder="Selecciona " [showClear]="true"
                                            optionLabel="valor1">
                                        </p-dropdown>
                                    </div>

                                    <div class="p-field p-col-12 p-md-3 p-sm-8">
                                        <strong>Tipo Documento <span>*</span></strong>
                                        <p-dropdown class="DropExtenso fondo-gris"
                                            [disabled]="!existeEstablecimientoSeleccionado"
                                            (onChange)="onObtenerTipoDocumento($event.value)" [options]="arrayTipoDocumento"
                                            formControlName="documentoid" placeholder="Selecciona" [showClear]="true"
                                            optionLabel="valor2">
                                        </p-dropdown>
                                    </div>

                                    <div class="p-field p-col-12 p-md-2 p-sm-2">
                                        <strong><br></strong>
                                        <p-dropdown class="extender" [options]="arraySeriePorDocumento"
                                            formControlName="serieventa" placeholder="Selecciona" [showClear]="true"
                                            optionLabel="valor1"></p-dropdown>
                                    </div>

                                    <div class="p-field p-col-12 p-md-1 p-sm-2 botonBuscar">
                                        <input type="number" disabled pInputText
                                            class="p-inputtext-sm-clear-grey number-clear" formControlName="secuencialventa"
                                            placeholder="ingresar">
                                    </div> 

                                    <div class="p-field p-col-12 p-md-3 p-sm-6">
                                        <strong>Condición Pago <span>*</span></strong>
                                        <div class="p-inputgroup">
                                            <p-dropdown class="extender"
                                                (onChange)="onObtenerCondicionPago($event.value.valor1)"
                                                [options]="arrayCondicionPago" formControlName="condicionpagoid"
                                                placeholder="Selecciona " [showClear]="true" optionLabel="valor1">
                                            </p-dropdown>
                                            <button type="button" *ngIf="existeCondicionPagoCredito"
                                                pTooltip="Agregar Cuotas" class="p-button-sm" tooltipPosition="left"
                                                (click)="onModalDetalleCondicionPago()" pButton icon="pi pi-plus"></button>
                                        </div>
                                    </div>
    
                                    <div class="p-field p-col-12 p-md-2 p-sm-6">
                                        <strong>Concepto</strong>
                                        <p-dropdown class="DropExtenso" [options]="arrayCoceptos"
                                            formControlName="conceptocontableid" placeholder="Selecciona "
                                            [showClear]="true" optionLabel="valor1"></p-dropdown>
                                    </div>

                                    <div class="p-field p-col-12 p-md-2 p-sm-6">
                                        <strong>Tipo Operación <span>*</span></strong>
                                        <p-dropdown class="DropExtenso" [options]="arrayTipoOperacion"
                                            formControlName="codtipooperacion" placeholder="Selecciona " [showClear]="true"
                                            optionLabel="valor1"></p-dropdown>
                                    </div>

                                    <div class="p-field p-col-12 p-md-8 ">
                                        <strong>Glosa</strong>
                                        <input type="text" pInputText formControlName="glosa"
                                            class="p-inputtext-sm-clear-grey p-inputtext-sm-simple pd-5 width-100"
                                            placeholder="ingresar una glosa">
                                    </div>

                                <div class="btn-options-flotant">
                                    <button pButton type="button" 
                                        style="margin-right: 1%;" (click)="onModalConfiguracionesAdicionales()" icon="pi pi-plus">
                                    </button>
                                </div>  


                                </div>
                            </div>

                            <!-- FORM ARRAY DEL DETALLE CONDICION DE PAGO -->
                            <div *ngIf="modalDetallesCondicionPago">
                                <p-dialog header="DETALLE FORMA DE PAGO" [(visible)]="modalDetallesCondicionPago"
                                    [modal]="true" [style]="{width: '400px'}">
                                    <div class="tabladetalles" > 
                                        <p-table  [value]="detallesCondicionPago" [scrollable]="true" responsiveLayout="stack">
                                            <ng-template pTemplate="header">
                                                <tr>
                                                    <th id="LXX-detail">Cuota</th>
                                                    <th id="C-detail">Importe</th>
                                                    <th id="CXXX-calendar-detail">Fec.Pago</th>
                                                    <th id="L-detail">Acción</th>
                                                </tr>
                                            </ng-template>

                                            <ng-template pTemplate="body" let-detalles let-rowIndex="rowIndex"
                                                formArrayName="arrayDetallesCondicionPago">
                                                <tr [formGroupName]="rowIndex">
                                                    <td id="LXX-detail">
                                                        <strong class="p-column-title">Nro</strong>
                                                        <span>Nro: {{rowIndex + 1 | number:'3.0-0'}} </span>
                                                    </td>
                                                    <td id="C-detail">
                                                        <strong class="p-column-title">Importe</strong>
                                                        <input type="number" [min]="0" class="p-inputtext-sm-form" pInputText formControlName="importepagocuota">
                                                    </td>
                                                    <td id="CXXX-calendar-detail">
                                                        <strong class="p-column-title">Fec.Pago</strong>
                                                        <p-calendar readonlyInput="true" appendTo="body"
                                                            [showIcon]="true" dateFormat="dd/mm/yy" formControlName="fechapagocuota">
                                                        </p-calendar>
                                                    </td>
                                                    <td id="L-detail">
                                                        <button class="p-button-cancelar" pButton type="button" 
                                                            (click)="onEliminarDetalleCondicionPago(rowIndex, detalles.value.ventacuotascreditoid)"
                                                            icon="pi pi-trash">
                                                        </button>
                                                    </td>

                                                </tr>
                                            </ng-template> 
                                        </p-table>  
                                    </div>
                                    <br>
                                    <div class="centrar" style="margin-bottom: 2%;" >
                                        <button type="button" label="Agregar Detalle" pTooltip="Agregar"
                                            class="p-button-generico-azul" (click)="onAgregarDetalleCondicionPago()"
                                            tooltipPosition="left" pButton icon="pi pi-plus"></button>
                                    </div>
                                 
                                </p-dialog>
                            </div>
                        <!--  FIN DETALLE CONDICION DE PAGO -->
                        </div>
                    </div>
                  
                    <br>
    
                    <div class="container-fluid">
                        <div class=" card-box">
                            <!-- TABS FORM -->
                            <p-tabMenu [model]="items" [activeItem]="activeItem"></p-tabMenu>

                            <!-- FORM ARRAY DEL DETALLE DE LA VENTA-->
                            <div *ngIf="DetalleForm">
                                <div>
                                    <br>
                                    <button pButton pRipple type="button" label="Agregar detalle Venta"
                                        class="p-button-rounded p-button-agregar " icon="pi pi-plus"
                                        (click)="onAgregarDetalleVenta()"></button>
        
                                    <p-table 
                                        class="TablaDetalleCondicionPago                                     tabladetalles" 
                                        [value]="detallesVentaForm"
                                        [scrollable]="true" responsiveLayout="stack">
                                        <ng-template pTemplate="header">
                                            <tr class="centrar encabezados-grid">
                                                <th>Acción</th>
                                                <th id="lg">Almacén</th>
                                                <th id="md">Cod Producto</th>
                                                <th id="lg">Producto/Servicio</th>
                                                <th id="lg">Und Medida</th>
                                                <th id="lg">T.Afectacion</th>
                                                <th id="sd">P.Inc.Igv</th>
                                                <th id="sd">Cantidad</th>
                                                <th id="sd">Precio.U</th>
                                                <th id="sd">Base.Impon</th>
                                                <th id="sd">% Dscto</th>
                                                <th id="sd">Imp.Dscto</th>
                                                <th id="lg">Observaciones</th>
                                                <th id="sd">Valor Venta</th>
                                                <th id="sd">IGV</th>
                                                <th id="sd">Imp.Otros.C</th>
                                                <th id="sd">ICBPER</th>
                                                <th id="sd">Precio.V</th>
                                                <th id="sd">N.Lote</th>
                                                <th id="sd">N.Serie</th> 
                                                <th id="md">F.Vencimiento</th>
                                                <th id="sd">Nro Cuenta</th>
                                            </tr>
                                        </ng-template>


                                        <ng-template pTemplate="body" let-detallesVenta let-rowIndex="rowIndex"
                                            formArrayName="arrayDetalleVenta">
                                            <tr [formGroupName]="rowIndex" class="body-grid">
                                                <td id="sd">
                                                    <button class="p-button-sm p-button-rounded" pButton type="button"
                                                        style=" background-color: #D72250;"
                                                        (click)="onEliminarDetalleVenta(rowIndex)" icon="pi pi-trash">
                                                    </button>
                                                </td>
                                                <td id="lg">
                                                    <strong class="p-column-title">Almacén</strong>
                                                    <p-dropdown class="extender" appendTo="body" [options]="arrayAlmacen"
                                                        formControlName="almacenid" placeholder="Selecciona"
                                                        [showClear]="true" optionLabel="valor1"></p-dropdown>
                                                </td>
                                                <td id="md">
                                                    <strong class="p-column-title">Cod.Producto</strong>
                                                    <input type="text"
                                                        (keydown.enter)="onBuscarProductoPorCodigo(rowIndex)"
                                                        (blur)="onBuscarProductoPorCodigo(rowIndex)"
                                                        class="p-inputtext" pInputText formControlName="codproductofinal">
                                                    <button type="button" (click)="onModalBuscarProducto(rowIndex)"
                                                        pTooltip="Buscar" type="button" tooltipPosition="left" pButton
                                                        icon="pi pi-search" class="p-button-sm"></button>
                                                </td>
                                                <td  id="lg">
                                                    <strong class="p-column-title">Producto/Servicio</strong>
                                                    <input type="text" [min]="0" class="p-inputtext"
                                                        pInputText formControlName="descripcionproducto">
                                                </td>
                                                <td id="lg">
                                                    <strong class="p-column-title">Und Medida</strong>
                                                    <p-dropdown class="extender" appendTo="body"
                                                        [options]="arrayUnidadMedida" formControlName="unidadmedidaid"
                                                        placeholder="Selecciona" [showClear]="true" optionLabel="valor1">
                                                    </p-dropdown>
                                                </td>
                                                <td id="lg">
                                                    <strong class="p-column-title">T.Afectacion</strong>
                                                    <p-dropdown class="extender"
                                                        (onChange)="onObtenertipoAfectacionDetalle(rowIndex, detallesVenta.value.tipoafectacionid)"
                                                        appendTo="body" [options]="arrayTipoAfectacion"
                                                        formControlName="tipoafectacionid" placeholder="Selecciona"
                                                        [showClear]="true" optionLabel="valor1"></p-dropdown>
                                                </td>
                                                <td id="sd">
                                                    <strong class="p-column-title">P.Inc.Igv </strong>
                                                    <p-inputSwitch (click)="onCalcularPrecioVenta(rowIndex)"
                                                        formControlName="precioincluyeigv"></p-inputSwitch>
                                                </td>
                                                <td id="sd">
                                                    <strong class="p-column-title">Cantidad</strong>
                                                    <input type="number" 
                                                        (keydown.enter)="onCalcularPrecioVenta(rowIndex)"
                                                        (keydown.Tab)="onCalcularPrecioVenta(rowIndex)" class="p-inputtext"
                                                        pInputText formControlName="cantidad">
                                                </td>
                                                <td id="sd">
                                                    <strong class="p-column-title">PrecioU</strong>
                                                    <input type="text" 
                                                        (keydown.enter)="onCalcularPrecioVenta(rowIndex)"
                                                        (keydown.Tab)="onCalcularPrecioVenta(rowIndex)" class="p-inputtext"
                                                        pInputText formControlName="preciounitario">
                                                </td>
                                                <td id="sd">
                                                    <strong class="p-column-title">Base Impon,</strong>
                                                    <input type="text" readonly
                                                        class="p-inputtext" pInputText formControlName="baseimponible">
                                                </td>
                                                <td id="sd">
                                                    <strong class="p-column-title">% Dcsto</strong>
                                                    <input type="number" 
                                                        (keydown.enter)="onCalcularPrecioVenta(rowIndex)"
                                                        (keydown.Tab)="onCalcularPrecioVenta(rowIndex)" class="p-inputtext"
                                                        pInputText formControlName="porcentajedescuento">
                                                </td>
                                                <td id="sd">
                                                    <strong class="p-column-title">Imp.Dcsto</strong>
                                                    <input type="number"  readonly
                                                        class="p-inputtext" pInputText formControlName="importedescuento">
                                                </td>
                                                <td  id="lg">
                                                    <strong class="p-column-title">Observaciones</strong>
                                                    <input type="text" [minlength]="0"
                                                        class="p-inputtext" pInputText formControlName="observaciones">
                                                </td>
                                                <td id="sd">
                                                    <strong class="p-column-title">Valor Venta</strong>
                                                    <input type="text"  readonly
                                                        class="p-inputtext" pInputText formControlName="valorVenta">
                                                </td>
                                                <td id="sd">
                                                    <strong class="p-column-title">IGV</strong>
                                                    <input type="number" readonly
                                                        [value]="detallesVentaForm[rowIndex].get('igv').value | number:'0.2-2'"
                                                        class="p-inputtext" pInputText formControlName="igv">
                                                </td>
                                                <td id="sd">
                                                    <strong class="p-column-title">Imp.Otros.C</strong>
                                                    <input type="number"
                                                        (keydown.enter)="onCalcularPrecioVenta(rowIndex)"
                                                        (keydown.Tab)="onCalcularPrecioVenta(rowIndex)" class="p-inputtext"
                                                        pInputText formControlName="importesotroscargos">
                                                </td>
                                                <td id="sd">
                                                    <strong class="p-column-title">ICBPER</strong>
                                                    <input type="number" readonly
                                                        class="p-inputtext" pInputText formControlName="importeicbper">
                                                </td>
                                                <td id="sd">
                                                    <strong class="p-column-title">PrecioV</strong>
                                                    <input type="number"  readonly
                                                        [value]="detallesVentaForm[rowIndex].get('precioventa').value | number:'0.2-2'"
                                                        class="p-inputtext" pInputText formControlName="precioventa">
                                                </td>
                                                <td id="sd">
                                                    <strong class="p-column-title">NroLote</strong>
                                                    <input type="number" [min]="0" class="p-inputtext"
                                                        pInputText formControlName="nroLote">
                                                </td>
                                                <td id="sd">
                                                    <strong class="p-column-title">NroSerie</strong>
                                                    <input type="number"[min]="0" class="p-inputtext"
                                                        pInputText formControlName="nroSerie">
                                                </td>
                                                <td id="md">
                                                    <strong class="p-column-title">F.Vencimiento</strong>
                                                    <p-calendar appendTo="body" readonlyInput="true" [showIcon]="true"
                                                        dateFormat="dd/mm/yy" formControlName="fechavencimiento">
                                                    </p-calendar>
                                                </td>
                                                <td id="sd">
                                                    <strong class="p-column-title">Nro Cuenta</strong>
                                                    <input type="number" [min]="0" class="p-inputtext"
                                                        pInputText formControlName="nrocuenta">
                                                </td>

                                            </tr>
                                        </ng-template>
                                        <ng-template pTemplate="emptymessage">
                                            <tr>
                                                <span> No existen registros </span>
                                            </tr>
                                        </ng-template>

                                    </p-table> 
                                </div> 
                            </div>
                            <!-- FIN DETALLE DE LA VENTA-->

                            <!-- FORM ARRAY DEL DETALLE GUIA REMISION-->
                            <div *ngIf="GuiaRemisionForm">
                                <div class="tabladetalles">  
                                    <p-table   [value]="detallesGuiaRemision"
                                        [scrollable]="true" responsiveLayout="stack">
                                        <ng-template pTemplate="header">
                                            <tr>
                                                <th id="C-detail">Serie Guía</th>
                                                <th id="C-detail">Nro Guía</th>
                                                <th id="L-detail">Acción</th>
                                            </tr>
                                        </ng-template>

                                        <ng-template pTemplate="body" let-detallesGuiaRemision let-rowIndex="rowIndex"
                                            formArrayName="arrayDetalleGuiaRemision">
                                            <tr [formGroupName]="rowIndex">
                                                <td id="C-detail">
                                                    <strong class="p-column-title">Serie Guía</strong>
                                                    <input type="text" [min]="0" class="p-inputtext-sm-form" pInputText
                                                        formControlName="serieguia">
                                                </td>
                                                <td id="C-detail">
                                                    <strong class="p-column-title">Nro Guía</strong>
                                                    <input type="number" [min]="0" class="p-inputtext-sm-form" pInputText
                                                        formControlName="nroguia">
                                                </td>
                                                <td id="L-detail">
                                                    <button class="p-button-sm p-button-rounded" pButton type="button" class="p-button-cancelar"
                                                        (click)="onEliminarDetalleGuiaRemision(rowIndex, detallesGuiaRemision.value.ventadocumentosreferenciaid)"
                                                        icon="pi pi-trash">
                                                    </button>
                                                </td>

                                            </tr>
                                        </ng-template>
                                        <ng-template pTemplate="emptymessage">
                                            <tr>
                                                <span> No existen registros </span>
                                            </tr>
                                        </ng-template> 
                                    </p-table> 
                                    <br> 
                                    <div class="BotonCondiciondePago">
                                        <button type="button" label="Agregar detalle guia remision" pTooltip="Agregar"
                                            class="p-button-generico-azul" (click)="onAgregarDetalleGuiaRemision()"
                                            tooltipPosition="left" pButton icon="pi pi-plus"></button>
                                    </div>
                                    
                                </div>
                                <hr>

                            </div>
                            <!-- FINDETALLE GUIA REMISION-->

                            <!-- FORM ARRAY DEL DETALLE DOCUMENTO REFERENCIA-->
                            <div *ngIf="DocReferenciaForm">
                                
                                    <div  class="tabladetalles">
                                        <div class="formulario">
                                            <strong>Motivo Nota:</strong>
                                            <br>
                                            <p-dropdown class="extender" [options]="arrayMotivoNota"
                                                formControlName="motivonotaid" placeholder="Selecciona " [showClear]="true"
                                                optionLabel="valor1"></p-dropdown>
                                        </div> 
                                        <br> 
                                        <p-table class="tabladetalles" [value]="detallesDocumentoRef"
                                            [scrollable]="true" responsiveLayout="stack">
                                            <ng-template pTemplate="header">
                                                <tr>
                                                    <th>Acción</th>
                                                    <th>T. Documento</th>
                                                    <th>Serie</th>
                                                    <th>Correlativo</th>
                                                    <th>Fec.Referencia</th>
                                                    <th>Amarrar</th>
                                                </tr>
                                            </ng-template>

                                            <ng-template pTemplate="body" let-detallesDocumentoRef let-rowIndex="rowIndex"
                                                formArrayName="arrayDetalleDocumentoRef">
                                                <tr [formGroupName]="rowIndex">
                                                    <td>
                                                        <button class="p-button-sm p-button-rounded" pButton type="button"
                                                            style=" background-color: #D72250;"
                                                            (click)="onEliminarDetalleDocumentoRef(rowIndex, detallesDocumentoRef.value.ventadocumentosreferenciaid)"
                                                            icon="pi pi-trash">
                                                        </button>
                                                    </td>

                                                    <td>
                                                        <strong class="p-column-title">T. Documento</strong>
                                                        <p-dropdown class="extender" appendTo="body"
                                                            [options]="arrayTipoDocumento" formControlName="tipodocumento"
                                                            placeholder="Selecciona" [showClear]="true"
                                                            optionLabel="valor2">
                                                        </p-dropdown>
                                                    </td>
                                                    <td>
                                                        <strong class="p-column-title">Serie</strong>
                                                        <input type="text" style="width: 80px;" [min]="0"
                                                            class="p-inputtext-sm" pInputText formControlName="serie">
                                                    </td>
                                                    <td>
                                                        <strong class="p-column-title">Correlativo</strong>
                                                        <input type="number" style="width: 80px;" [min]="0"
                                                            class="p-inputtext-sm" pInputText formControlName="correlativo">
                                                    </td>
                                                    <td>
                                                        <strong class="p-column-title">Fec.Referencia</strong>
                                                        <p-calendar appendTo="body" readonlyInput="true" [showIcon]="true"
                                                            dateFormat="dd/mm/yy" formControlName="fecReferencia">
                                                        </p-calendar>
                                                    </td>
                                                    <td>
                                                        <button class="p-button-sm p-button-rounded" pButton type="button"
                                                            (click)="onReferenciarDetalleDocumentoRef(rowIndex)"
                                                            icon="fas fa-sync">
                                                        </button>
                                                    </td>

                                                </tr>
                                            </ng-template>

                                            <ng-template pTemplate="emptymessage">
                                                <tr>
                                                    <span> No existen registros </span>
                                                </tr>
                                            </ng-template>

                                        </p-table>
                                    </div>
                                    <br>
                                    
                                    <button type="button" label="Agregar detalle documento referencia"
                                        pTooltip="Agregar" class="p-button-generico-azul" (click)="onAgregarDetalleDocumentoRef()"
                                        tooltipPosition="left" pButton icon="pi pi-plus">
                                    </button>
                                    
                            </div>
                            <!-- FIN DETALLE GUIA REMISION-->


                            <!-- <div *ngIf="OtrosForm">
                                <br>
                                <p-fieldset>
                                    <ng-template pTemplate="header">Descuento Global</ng-template>

                                    <div class="formulario">
                                        <strong>Descuento Global:</strong>
                                        <div class="p-inputgroup">
                                            <input type="number" (blur)="onConvertiraPorcentaje()" pInputText
                                                formControlName="dsctoglobalrporcentaje" class="p-inputtext-sm"
                                                placeholder="0">
                                            <button class="p-button-sm" type="button" pButton label="% Porcentaje"
                                                (click)="onConvertiraPorcentaje()"> </button>
                                        </div>
                                    </div>

                                </p-fieldset>
                                <br>
                                <p-fieldset>
                                    <ng-template pTemplate="header">Detracción</ng-template>
                                    <div class="p-col-12">
                                        <div class="p-fluid p-formgrid p-grid">
                                            <div class="p-field p-col-12 p-md-6">
                                                <div class="formulario">
                                                    <strong>Venta afecta detracción:</strong>
                                                    <p-inputSwitch formControlName="esafectodetraccion">
                                                    </p-inputSwitch>
                                                </div>
                                            </div>
                                            <div class="p-field p-col-12 p-md-6">
                                                <div class="formulario">
                                                    <strong>Porcentaje:</strong>
                                                    <input type="text" pInputText formControlName="porcentajedetraccion"
                                                        class="p-inputtext-sm" placeholder="%">
                                                </div>
                                            </div>
                                            <div class="p-field p-col-12 p-lg-12 p-md-12">
                                                <div class="formulario">
                                                    <strong>Código Detracción:</strong>
                                                    <p-dropdown class="extender" appendTo="body"
                                                        [options]="arrayCodigoDetraccion" formControlName="codigodetraccion"
                                                        placeholder="Selecciona" [showClear]="true" optionLabel="valor1">
                                                    </p-dropdown>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </p-fieldset>
                                <br>
                                <p-fieldset>
                                    <ng-template pTemplate="header">Adicionales</ng-template>
                                    <div class="p-col-12">
                                        <div class="p-fluid p-formgrid p-grid">
                                            <div class="p-field p-col-12 p-lg-4 p-md-6">
                                                <div class="formulario">
                                                    <span> sin filtros </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </p-fieldset>

                            </div> -->

                            <!-- <div *ngIf="FacturaguiaForm">
                                <span> Sin informacion</span>
                            </div> -->

                            <div *ngIf="TotalesForm">
                                <div class="p-col-12">
                                    <div class="p-fluid p-formgrid p-grid">
                                        <div class="p-field p-col-12 p-lg-6 p-md-6">
                                            <div class="totalesResumen" style="margin: 3%;">
                                                <strong>Descuento global:</strong>
                                                <input type="number" pInputText readonly
                                                    formControlName="dsctoglobalimporte" class="p-inputtext-sm-form"
                                                    placeholder="0.00">

                                                <strong>Descuento por item:</strong>
                                                <input type="number" pInputText readonly formControlName="descuentoporitem"
                                                    class="p-inputtext-sm-form" placeholder="0.00">

                                                <strong>Descuento Total:</strong>
                                                <input type="number" pInputText readonly formControlName="importedescuento"
                                                    class="p-inputtext-sm-form" placeholder="0.00">

                                                <strong>Anticipo:</strong>
                                                <input type="number" pInputText readonly formControlName="importeanticipo"
                                                    class="p-inputtext-sm-form" placeholder="0.00">

                                                <strong>Exonerada:</strong>
                                                <input type="number" pInputText readonly formControlName="importeexonerado"
                                                    class="p-inputtext-sm-form" placeholder="0.00">

                                                <strong>Inafecta:</strong>
                                                <input type="number" pInputText readonly formControlName="importeinafecto"
                                                    class="p-inputtext-sm-form" placeholder="0.00">
                                            </div>
                                        </div>

                                        <div class="p-field p-col-12 p-lg-6 p-md-6">
                                            <div class="totalesResumen" style="margin: 3%;">

                                                <strong>Gravada:</strong>
                                                <input type="number" pInputText readonly formControlName="importegravada"
                                                    class="p-inputtext-sm-form" placeholder="0.00">

                                                <strong>IGV:</strong>
                                                <input type="number" pInputText readonly formControlName="importeigv"
                                                    class="p-inputtext-sm-form" placeholder="0.00">

                                                <strong>Gratuita:</strong>
                                                <input type="number" pInputText readonly formControlName="importegratuita"
                                                    class="p-inputtext-sm-form" placeholder="0.00">

                                                <strong>Otros Tributos:</strong>
                                                <input type="number" pInputText readonly
                                                    formControlName="importeotrostributos" class="p-inputtext-sm-form"
                                                    placeholder="0.00">

                                                <strong>ICBPER:</strong>
                                                <input type="number" pInputText readonly formControlName="importeicbper"
                                                    class="p-inputtext-sm-form" placeholder="0.00">

                                                <strong class="totalaMostrar">TOTAL:</strong>
                                                <input type="number" pInputText readonly formControlName="importetotalventa"
                                                    class="p-inputtext-sm-form" placeholder="0.00">

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!--  FIN TABS FORM -->
                            <br>
                            <hr>
                            <div class="importes" *ngIf="TabTotalesActivo">
                                <strong class="totalaMostrar">Importe Total </strong>
                                <strong> {{ totalaPagar | currency:'S/. '}}</strong>
                                <button type="button" type="button" (click)="activateMenu('4')" pTooltip="Mas info..."
                                    class="p-button-sm" tooltipPosition="left" pButton icon="pi pi-info"></button>
                            </div>

                        </div>
                    </div>
                </div>

                <div [ngClass]="{'col-md-1': changeCols, 'col-md-5': !changeCols }">
                    <div class="row">
                        <div class="p-fluid p-formgrid p-grid formulario-campo-obligatorio">
                            <div class="container-fluid">
                                <div class="card-box card-desplegable">
    
                                    <button class="p-button-sm" pButton type="button" icon="pi pi-bars"
                                    (click)="onBtnConfigBar($event)"> </button>
                                    
                                    <div class="title-options" (click)="onBtnConfigBar($event)" [hidden]="!changeCols"> <p> <i class="pi pi-arrow-up"></i> Más Opciones</p></div>
                                    <div class="title-options-internal" [hidden]="changeCols"> <h2> Más Opciones</h2></div>

                                    <div [hidden]="changeCols"> 
                                        <br>
                                        <p-accordion [multiple]="true">
                                            <p-accordionTab header="Cliente" [selected]="true">  
                                                <div class="p-field p-col-12">
                                                    <strong>Busca un Cliente</strong>
                                                    <div class="p-inputgroup">
                                                        <input type="text" readonly formControlName="nombrecliente" pInputText
                                                            class="p-inputtext-sm-form" placeholder="Buscar un cliente">
                                                        <button type="button" pTooltip="Buscar" class="p-button-generico-azul"
                                                            tooltipPosition="left" (click)="onBuscarCliente();" pButton
                                                            icon="pi pi-search"></button>
                                                        <button *ngIf="existeClienteSeleccionado" type="button" pTooltip="Buscar"
                                                            class="p-button-cancelar"
                                                            tooltipPosition="left" (click)="onBorrarCliente();" pButton
                                                            icon="pi pi-trash"></button>
                                                    </div>
                                                </div> 
                                                <div class="p-field p-col-12">
                                                    <div *ngIf="existeDireccionCliente">
                                                        <strong>Dirección Cliente</strong>
                                                        <input type="text" readonly formControlName="direccioncliente" pInputText
                                                            class="p-inputtext-sm-form"
                                                            placeholder="dirección un cliente">
                                                    </div>
                                                </div> 
                                            </p-accordionTab> 
                                            <p-accordionTab header="Generales">  
                                                <p-accordion [selected]="true"> 
                                                    <p-accordionTab header="Fechas">
                                                        <div class="p-field p-col-12"> 
                                                            <div class="row">
                                                                <div class="p-field p-col-6">
                                                                    <!-- <strong>Fecha Emisión <span>*</span></strong> -->
                                                                    <strong>Emisión <span>*</span></strong>
                                                                    <p-calendar readonlyInput="true" [showIcon]="true" dateFormat="dd/mm/yy"
                                                                        formControlName="fechaemision"></p-calendar>
                                                                </div>
                        
                                                                <div class="p-field p-col-6">
                                                                    <!-- <strong>Fecha Vencimiento</strong> -->
                                                                    <strong>Vencimiento</strong>
                                                                    <p-calendar readonlyInput="true" [showIcon]="true" dateFormat="dd/mm/yy"
                                                                        formControlName="fechavencimiento"></p-calendar>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </p-accordionTab>
                                                    <p-accordionTab header="Moneda / Tipo Cambio / Estado"> 
                                                        <div class="p-field p-col-12"> 
                                                            <div class="row">
                                                                <div class="p-field p-col-6">
                                                                    <strong>Moneda <span>*</span></strong>
                                                                    <p-dropdown class="DropExtenso" [options]="arrayMonedas"
                                                                        formControlName="monedaid" placeholder="Selecciona " [showClear]="true"
                                                                        optionLabel="valor1"></p-dropdown>
                                                                </div>
            
                                                                <div class="p-field p-col-6">
                                                                    <strong>Tipo Cambio</strong>
                                                                    <input type="number" pInputText formControlName="tipocambio"
                                                                        class="p-inputtext-sm-clear-grey p-inputtext-sm-simple" placeholder="0.00">
                                                                </div>
                                                            </div>
                                                            <div class="row">
                                                                <div class="p-field p-col-6">
                                                                    <strong>Estado</strong>
                                                                    <p-dropdown class="DropExtenso" [options]="arrayEstado" formControlName="estadoid"
                                                                        placeholder="Selecciona " [showClear]="true" optionLabel="nombre"></p-dropdown>
                                                                </div>
            
                                                                <div class="p-field p-col-6">
                                                                
                                                                </div>
                                                            </div>
            
                                                        </div>
                                                    </p-accordionTab>
                                                    <p-accordionTab header="Detracción">
                                                        <div class="p-col-12">
                                                            <div class="p-fluid p-formgrid p-grid"> 
                                                                <div class="totalesResumen"> 
                                                                    <strong>Precios Incluyen Igv.</strong>
                                                                    <p-inputSwitch></p-inputSwitch>
                                                                
                                                                    <strong>Afecto Retención</strong> 
                                                                    <p-inputSwitch></p-inputSwitch>
                                                                
                                                                    <strong>Afecto Detracción</strong> 
                                                                    <p-inputSwitch (onChange)="onAfectoDetraccion($event.checked)" formControlName="esafectodetraccion"> </p-inputSwitch>
                                                                </div> 
                                                            </div>
                                                        </div>
                                                    
                                                        <div [hidden]="!mostrarBloqueAfectoDetraccion">
                                                            <div class="p-field p-col-10">
                                                                <strong>Porcentaje:</strong>
                                                                <input type="text" pInputText formControlName="porcentajedetraccion"
                                                                class="p-inputtext-sm-form" placeholder="Ingresa un porcentaje">
                                                            </div> 
                                                            <div class="p-field p-col-10">
                                                                <strong>Código Detracción:</strong>
                                                                <p-dropdown class="extender" appendTo="body"
                                                                    [options]="arrayCodigoDetraccion" formControlName="codigodetraccion"
                                                                    placeholder="Selecciona" [showClear]="true" optionLabel="valor1">
                                                                </p-dropdown>
                                                            </div> 
                                                        </div>
                                                            
                                                        
                                                    </p-accordionTab>
                                                    <p-accordionTab header="Descuento">
                                                        <div class="p-field p-col-12">  
                                                            <strong>Descuento Global:</strong>
                                                            <div class="p-inputgroup">
                                                                <input type="number" pInputText
                                                                    formControlName="dsctoglobalrporcentaje" class="p-inputtext-sm-form"
                                                                    placeholder="0">
                                                                <button class="p-button-sm" type="button" pButton label=" % "
                                                                    (click)="onConvertiraPorcentaje()"> </button>
                                                            </div>  
                                                        </div>
                                                    </p-accordionTab>
                                                </p-accordion>
    
                                            </p-accordionTab> 
                                        </p-accordion>
    
                                    </div>
                                </div>
                            </div>
                    </div>
                    </div> <!-- termina Container -->
                </div>
            </div>

        
            <p-dialog header="CONFIGURACIONES ADICIONALES" [(visible)]="modalConfiguracionesAdicionales" [modal]="true"
            [style]="{width: '80vw'}"> 
                <p-accordion [multiple]="true">
                    <p-accordionTab header="Cliente" [selected]="true">  
                        <div class="p-field p-col-12">
                            <strong>Busca un Cliente</strong>
                            <div class="p-inputgroup">
                                <input type="text" readonly formControlName="nombrecliente" pInputText
                                    class="p-inputtext-sm-clear-grey pd-5" placeholder="Buscar un cliente">
                                <button type="button" pTooltip="Buscar" class="p-button-blue-light"
                                    tooltipPosition="left" (click)="onBuscarCliente();" pButton
                                    icon="pi pi-search"></button>
                                <button *ngIf="existeClienteSeleccionado" type="button" pTooltip="Buscar"
                                    style=" background-color: #D72250;" class="p-button-blue-light-buscar"
                                    tooltipPosition="left" (click)="onBorrarCliente();" pButton
                                    icon="pi pi-trash"></button>
                            </div>
                        </div> 
                        <div class="p-field p-col-12">
                            <div *ngIf="existeDireccionCliente">
                                <strong>Dirección Cliente</strong>
                                <input type="text" readonly formControlName="direccioncliente" pInputText
                                    class="p-inputtext-sm-clear-grey pd-5 width-100"
                                    placeholder="dirección un cliente">
                            </div>
                        </div> 
                    </p-accordionTab> 
                    <p-accordionTab header="Generales">  
                        <p-accordion [selected]="true"> 
                            <p-accordionTab header="Fechas">
                                <div class="p-field p-col-12"> 
                                    <div class="row">
                                        <div class="p-field p-col-6">
                                            <!-- <strong>Fecha Emisión <span>*</span></strong> -->
                                            <strong>Emisión <span>*</span></strong>
                                            <p-calendar readonlyInput="true" [showIcon]="true" dateFormat="dd/mm/yy"
                                                formControlName="fechaemision"></p-calendar>
                                        </div>
        
                                        <div class="p-field p-col-6">
                                            <!-- <strong>Fecha Vencimiento</strong> -->
                                            <strong>Vencimiento</strong>
                                            <p-calendar readonlyInput="true" [showIcon]="true" dateFormat="dd/mm/yy"
                                                formControlName="fechavencimiento"></p-calendar>
                                        </div>
                                    </div>
                                </div>
                            </p-accordionTab>
                            <p-accordionTab header="Moneda / Tipo Cambio / Estado"> 
                                <div class="p-field p-col-12"> 
                                    <div class="row">
                                        <div class="p-field p-col-6">
                                            <strong>Moneda <span>*</span></strong>
                                            <p-dropdown class="DropExtenso" [options]="arrayMonedas"
                                                formControlName="monedaid" placeholder="Selecciona " [showClear]="true"
                                                optionLabel="valor1"></p-dropdown>
                                        </div>
        
                                        <div class="p-field p-col-6">
                                            <strong>Tipo Cambio</strong>
                                            <input type="number" pInputText formControlName="tipocambio"
                                                class="p-inputtext-sm-clear-grey p-inputtext-sm-simple" placeholder="0.00">
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="p-field p-col-6">
                                            <strong>Estado</strong>
                                            <p-dropdown class="DropExtenso" [options]="arrayEstado" formControlName="estadoid"
                                                placeholder="Selecciona " [showClear]="true" optionLabel="nombre"></p-dropdown>
                                        </div>
        
                                        <div class="p-field p-col-6">
                                            
                                        </div>
                                    </div>
        
                                </div>
                            </p-accordionTab>
                            <p-accordionTab header="Detracción">
                                <div class="p-col-12">
                                    <div class="p-fluid p-formgrid p-grid"> 
                                        <div class="totalesResumen"> 
                                            <strong>Precios Incluyen Igv.</strong>
                                            <p-inputSwitch></p-inputSwitch>
                                        
                                            <strong>Afecto Retención</strong> 
                                            <p-inputSwitch></p-inputSwitch>
                                        
                                            <strong>Afecto Detracción</strong> 
                                            <p-inputSwitch (onChange)="onAfectoDetraccion($event.checked)" formControlName="esafectodetraccion"> </p-inputSwitch>
                                        </div> 
                                    </div>
                                </div>
                            
                                <div [hidden]="!mostrarBloqueAfectoDetraccion">
                                    <div class="p-field p-col-10">
                                        <strong>Porcentaje:</strong>
                                        <input type="text" pInputText formControlName="porcentajedetraccion"
                                        class="p-inputtext-sm-form" placeholder="Ingresa un porcentaje">
                                    </div> 
                                    <div class="p-field p-col-10">
                                        <strong>Código Detracción:</strong>
                                        <p-dropdown class="extender" appendTo="body"
                                            [options]="arrayCodigoDetraccion" formControlName="codigodetraccion"
                                            placeholder="Selecciona" [showClear]="true" optionLabel="valor1">
                                        </p-dropdown>
                                    </div> 
                                </div>
                                    
                                
                            </p-accordionTab>
                            <p-accordionTab header="Descuento">
                                <div class="p-field p-col-12"> 
                                    
                                    <div class="p-field p-col-10">
                                        <strong>Descuento Global:</strong>
                                        <div class="p-inputgroup">
                                            <input type="number" pInputText
                                                formControlName="dsctoglobalrporcentaje" class="p-inputtext-sm-form"
                                                placeholder="0">
                                            <button class="p-button-sm" type="button" pButton label=" % "
                                                (click)="onConvertiraPorcentaje()"> </button>
                                        </div> 
                                    </div> 
        
                                </div>
                            </p-accordionTab>
                        </p-accordion>
        
                    </p-accordionTab> 
                </p-accordion>
            </p-dialog>
            
        </form>

    </div>
</div>

<!-- VISTA Y DIALOG -->
<app-venta-reporte *ngIf="VistaReporte" [dataReporte]="dataReporte" (cerrar)="onRetornar()"></app-venta-reporte>
<app-cobrar *ngIf="VistaCobrar" [dataCobrar]="dataCobrar" (cerrar)="onCobradoExitoso($event)"></app-cobrar>

<div *ngIf="modalBuscarPersona">
    <p-dialog header="BUSCAR PERSONA" [(visible)]="modalBuscarPersona" [modal]="true" [style]="{width: '80vw'}">
        <app-buscar-persona [dataPersona]="'Cliente'" (PersonaSelect)="onPintarPersonaSeleccionada($event)">
        </app-buscar-persona>
    </p-dialog>
</div>

<div *ngIf="modalBuscarProducto">
    <p-dialog header="BUSCAR PRODUCTO" [(visible)]="modalBuscarProducto" [modal]="true" [style]="{width: '80vw'}">
        <app-buscar-producto [dataProductos]="dataProductos" (productoSelect)="onPintarProductoSeleccionado($event)">
        </app-buscar-producto>
    </p-dialog>
</div>

<div *ngIf="modalImprimirTicket">
    <p-dialog header="CONFIGURAR IMPRESORA TIKETERA" [(visible)]="modalImprimirTicket" [modal]="true"
        [style]="{width: '80vw'}">
        <form [formGroup]="FormImpresion">
            <div class="p-col-12">
                <div class="p-fluid p-formgrid p-grid">
                    <div class="p-field p-col-12 md-6">
                        <strong>Host de Impresión:</strong>
                        <div class="p-inputgroup">
                            <input type="text" pInputText formControlName="hostImpresion" class="p-inputtext-sm">
                            <button class="p-button-sm p-button-gris" type="button" pButton label="Aplicar Host"
                                (click)="onLoadImpresoras()"> </button>
                        </div>
                    </div>
                    <div class="p-field p-col-12 md-6">
                        <strong>Impresora:</strong>
                        <p-dropdown class="extender" [disabled]="bloquearComboImpresoras" appendTo="body"
                            [options]="arrayImpresoras" formControlName="nombreImpresora" placeholder="Selecciona"
                            [showClear]="true" optionLabel="nombre"></p-dropdown>
                    </div>
                    <div class="p-field p-col-12 md-6">
                        <strong>Ancho Papel(puntos)):</strong>
                        <input type="text" pInputText [minLength]="1" formControlName="anchoPapel"
                            class="p-inputtext-sm">
                    </div>
                </div>
            </div>
        </form>
        <div class="botones">
            <button class="p-button-registrar" pButton type="button" [disabled]="FormImpresion.invalid" label="Grabar"
                style="margin-right: 1%;" (click)="onSendImpresion()" icon="pi pi-check-circle">
            </button>

            <button class="p-button-cancelar" pButton type="button" icon="pi pi-times-circle" label="Cancelar"
                style=" background-color: #D72250;" (click)="modalImprimirTicket = false">
            </button>
        </div>
        <span style="text-align: center"><strong> NOTA:</strong> La impresora debe soportar comandos POS/ESC </span>

    </p-dialog>
</div>

