<ngx-spinner bdColor="rgba(0,0,0,0.8)" size="meidum" [zIndex]="997"  color="#fff" type="timer" [fullScreen]="true">
    <p style="font-size: 20px; color: white">CARGANDO. </p>
</ngx-spinner>

<div class="margintabla-home">
    <div class="card-box">
        <p-toolbar>
            <div class="p-toolbar-group-left">
                <h3><i class="fas fa-box"></i> {{tituloVistaNuevoProdcuto}}</h3>
            </div>

            <div class="p-toolbar-group-right">
                <button class="p-button-registrar" pButton  type="button"
                    [disabled]="Form.invalid" label="{{ (idProductoEdit) ? 'Actualizar' : 'Grabar' }}"
                    (click)="onAdd()" icon="pi pi-check-circle">
                </button>

                <button class="p-button-cancelar" pButton type="button" icon="pi pi-times-circle" label="Cancelar"
                   (click)="onRegresar()">
                </button>
            </div>
        </p-toolbar>
        
        <form [formGroup]="Form"> 
            <div class="row filasResponsive">
                <div class="col-md-6 p-fluid">
                    <p-fieldset [toggleable]="true">
                        <ng-template pTemplate="header">Codigo</ng-template> 
                            <strong>Interno <span>*</span></strong>
                            <input type="text" pInputText formControlName="codigoproducto"
                                class="p-inputtext-sm-form w-100"
                                placeholder="ingresar c贸digo del producto">

                            <strong>Proveedor</strong>
                            <input type="text" pInputText formControlName="proveedor"
                                class="p-inputtext-sm-form w-100"
                                placeholder="ingresar el proveedor">

                            <strong>SUNAT</strong>
                            <div class="p-inputgroup">
                                <input type="text" [value]="codigoProductoUnesco" pInputText
                                    (keydown.enter)="onBuscarUnesco()" formControlName="codigoParaBuscarUnesco"
                                    class="p-inputtext-sm-form w-100"
                                    placeholder="ingresar el nombre del producto a buscar">
                                <button type="button" pTooltip="Buscar" tooltipPosition="left"
                                    (click)="onBuscarUnesco();" pButton pRipple>Buscar</button>
                            </div>

                            <strong>Producto</strong>
                            <p-dropdown [disabled]="!arrayUnescoData" class="extender"
                                (onChange)="onSeleccionoProductoUnesco($event)" [options]="arrayUnescoData"
                                formControlName="codigounesco" placeholder="Selecciona un producto"
                                [showClear]="true" optionLabel="DescriptionES"></p-dropdown> 
                        
                    </p-fieldset> 
                </div>

                <div class="col-md-6 p-fluid">
                    <p-fieldset [toggleable]="true">
                        <ng-template pTemplate="header">Categorizacion</ng-template>
                        
                            <strong>Linea <span>*</span> </strong>
                            <p-dropdown [options]="arrayLinea" formControlName="idlinea"
                                placeholder="Seleccionar" optionLabel="valor1"></p-dropdown>

                            <strong>Color</strong>
                            <p-dropdown [options]="arrayColores" formControlName="idcolor"
                                placeholder="Seleccionar" optionLabel="valor1" [showClear]="true">
                            </p-dropdown>

                            <strong>Tipo Producto <span>*</span></strong>
                            <p-dropdown [options]="arrayTipoProducto"
                                formControlName="idtipoProducto" placeholder="Selecciona tipo de Producto"
                                optionLabel="valor1" [showClear]="true">
                            </p-dropdown>

                            <strong>Elegir:</strong>
                            <div class="radios-form">
                                <div>
                                    <strong style="margin: 15px;">SERVICIO</strong>

                                    <p-radioButton name="esServiciooArticulo" value="servicio"
                                        formControlName="esServiciooArticulo"></p-radioButton>
                                </div>
                                <div>
                                    <strong style="margin: 15px;">ARTICULO</strong>

                                    <p-radioButton name="esServiciooArticulo" value="articulo"
                                        formControlName="esServiciooArticulo"></p-radioButton>
                                </div>
                            </div>
                        
                    </p-fieldset> 
                </div>
            </div>
            
            <br>
 
            <div class="row filasResponsive">
                <div class="col-md-6 p-fluid"> 
                    <p-fieldset [toggleable]="true">
                        <ng-template pTemplate="header">Datos Principales</ng-template> 
                        <strong>Descripcion <span>*</span> </strong>
                        <textarea placeholder="Ingrese una descripci贸n" class="text-area-generico"
                            formControlName="descripcion" style="border: 0px; background: #dddddd;" id=""></textarea>
                        
                        <strong>Unidad de Medida<span>*</span> </strong>
                        <p-dropdown [options]="arrayUnidadMedida" formControlName="unidadMedida" 
                            placeholder="Seleccionar unidad de medida" optionLabel="valor1" [showClear]="true">
                        </p-dropdown>

                        <strong>Modelo</strong>
                        <input type="text" pInputText formControlName="modelo" class="p-inputtext-sm-form w-100" placeholder="ingresar un modelo">
                            
                    </p-fieldset> 
                </div>

                <div class="col-md-6 p-fluid"> 
                    <p-fieldset [toggleable]="true">
                        <ng-template pTemplate="header">Propiedad</ng-template>
                        <div class="p-field p-col-12 p-md-12">
                            <div class="filtoformCheck">
                                <div class="groupform"> 
                                    <strong> Activos<span >*</span> </strong>
                                    <p-inputSwitch formControlName="activo"></p-inputSwitch>
                                        
                                    <strong> Incluir cod. Proveedor en descripcion</strong>
                                    <p-inputSwitch formControlName="incluirProveedorEnDescripcion">
                                    </p-inputSwitch>

                                    <strong> Requiere Lote <span >*</span> </strong>
                                    <p-inputSwitch formControlName="requiereLote"></p-inputSwitch>

                                    <strong> Requiere Serie<span >*</span> </strong>
                                    <p-inputSwitch formControlName="requiereSerie"></p-inputSwitch> 
                                </div>

                                <div class="groupform">
                                    <strong> Usado Compras</strong>
                                    <p-inputSwitch formControlName="usadoCompras"></p-inputSwitch>

                                    <strong> Usado Ventas</strong>
                                    <p-inputSwitch formControlName="usadoVentas"></p-inputSwitch>

                                    <strong> Descripcion editable <span >*</span>
                                    </strong>
                                    <p-inputSwitch formControlName="descripcionEditable">
                                    </p-inputSwitch>

                                    <strong> Afecto a ICBPER <span>*</span>
                                    </strong>
                                    <p-inputSwitch formControlName="afectoICBPER"></p-inputSwitch>
                                </div>
                            </div>
                        </div>
                    </p-fieldset> 
                </div> 
            </div>
              
            <br> 


           
            <p-fieldset [toggleable]="true">
                <ng-template pTemplate="header">Precios</ng-template>  

                <div class="p-fluid p-formgrid p-grid">
                    <div class="p-field p-col-12 p-md-8"> 
                        <strong>Tipo afectaci贸n <span>*</span> </strong>
                        <p-dropdown formControlName="afectacionid"
                            [options]="arrayAfectaciones" placeholder="Seleccionar" optionLabel="valor1"
                            [showClear]="true"></p-dropdown>   
                    </div>
                    <div class="p-field p-col-12 p-md-4 boton-buscar-cabecera">
                        <button class="p-button-generico-azul" pButton type="button" label="Agregar"
                            (click)="onAgregarNuevoPrecio()" icon="pi pi-plus-circle">
                        </button>   
                    </div>
                </div>
            </p-fieldset>  
        
            

            <p-table 
            [value]="preciosForm"
            responsiveLayout="scroll"
            class="tabladetalles"> 
                <ng-template pTemplate="header">
                    <tr>
                        <th id="sd">Acci贸n</th>
                        <th id="lg-50">Moneda</th>
                        <th id="sd">P.Venta</th>
                        <th id="sd">Inc. IGV.</th>
                        <th id="sd" class="wpx-50" style="white-space: normal !important;">Condicion Cantidad</th>
                        <th id="sd">Cant. Aplicar</th>
                        <th id="sd">Cant. Und. Medida</th>
                        <th id="sd">Max. % Dsct.</th>
                        
                    </tr>
                </ng-template>

                <ng-template pTemplate="body" let-precios let-rowIndex="rowIndex" formArrayName="arrayPrecios">

                    <tr [formGroupName]="rowIndex">
                        <td id="sd">
                            <button class="p-button-cancelar" pButton type="button" 
                                (click)="onEliminarPrecio(rowIndex, precios.value.productopreciosid)"
                                icon="pi pi-trash">
                            </button>
                        </td>
                        <td id="lg-120">
                            <strong class="p-column-title">Moneda</strong>
                            <p-dropdown class="extender" appendTo="body" [options]="arrayMonedas"
                            formControlName="monedaid" placeholder="Seleccionar"
                            [showClear]="true" optionLabel="valor1"></p-dropdown> 
                        </td>
                        <td id="sd">
                            <strong class="p-column-title">P.Venta</strong>
                            <input style="text-align: right;" type="text" (keypress)="generalService.onSoloNumeros($event)"
                                class="p-inputtext-sm-form" pInputText formControlName="precioventa">
                        </td>
                        <td id="sd">
                            <strong class="p-column-title">Inc. IGV</strong>
                            <p-inputSwitch formControlName="precioincluyeigv"></p-inputSwitch>
                        </td>
                        <td id="sd">
                            <strong class="p-column-title">Condicion Cantidad</strong>
                            <p-inputSwitch formControlName="tienecondicionacantidad"></p-inputSwitch>
                        </td>
                        <td id="sd">
                            <strong class="p-column-title">Cant. Aplicar</strong>
                            <input min="0" formControlName="cantidadparaaplicar" type="number" pInputText
                                class="p-inputtext-sm-form">
                        </td>
                        <td id="sd">
                            <strong class="p-column-title">Cant. Und. Medida</strong>
                            <input min="0" formControlName="cantidadunidadmedida" type="number" pInputText
                                class="p-inputtext-sm-form">
                        </td>
                        <td id="sd">
                            <strong class="p-column-title">Max. % Dsct.</strong>
                            <input  min="0" formControlName="maxprocentajedscto"
                                type="number" pInputText class="p-inputtext-sm-form">
                        </td> 
                    </tr>

                </ng-template>
                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td colspan="6">No existen registros</td>
                    </tr>
                </ng-template>

            </p-table>

        </form>
    </div>

</div>